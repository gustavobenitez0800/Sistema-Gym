<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyD Funcional Gym - Gesti√≥n 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/x-icon" href="./img/Logo.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-card">
            <h1>AyD Funcional Gym</h1>
            <p>Acceso al Sistema</p>
            <form id="login-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Contrase√±a" required>
                <button type="submit">Ingresar</button>
            </form>
            <p id="login-error" class="error-msg"></p>
        </div>
    </div>

    <!-- Main App Layout (Hidden by default) -->
    <div id="app-layout" class="screen hidden">
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="img/Logo.png" alt="Logo" class="sidebar-logo">
                <h2>AyD Gym</h2>
            </div>
            <ul>
                <li onclick="showSection('dashboard')" class="active-nav">Dashboard</li>
                <li onclick="showSection('members')">Alumnos</li>
                <li onclick="showSection('payments')">Pagos</li>
            </ul>
            <div class="month-selector-container">
                <label>Mes de Operaci√≥n</label>
                <div class="month-navigator">
                    <button id="prev-month-btn" class="nav-btn" onclick="changeGlobalMonth(-1)">‚ùÆ</button>
                    <span id="global-month-label">Cargando...</span>
                    <button id="next-month-btn" class="nav-btn" onclick="changeGlobalMonth(1)">‚ùØ</button>
                </div>
            </div>
            <button id="logout-btn" class="logout-btn">Cerrar Sesi√≥n</button>
        </nav>

        <main class="content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active-section">
                <!-- Header with Month Display -->
                <div class="section-header">
                    <h2>Panel General - <span id="current-month-display">Enero 2026</span></h2>
                    <button class="btn-primary" onclick="exportMonthlyReport()">üìÑ Exportar PDF</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card stat-card-members">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <h3>Alumnos Activos</h3>
                            <p id="total-members" class="stat-value">0 / 300</p>
                            <small id="growth-stat" class="stat-growth">-- vs mes anterior</small>
                        </div>
                    </div>
                    <div class="stat-card stat-card-balance">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <h3>Balance Mensual</h3>
                            <p id="monthly-balance" class="stat-value">$0</p>
                        </div>
                    </div>
                    <div class="stat-card stat-card-overdue">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-content">
                            <h3>Vencimientos</h3>
                            <p id="overdue-count" class="stat-value text-danger">0</p>
                        </div>
                    </div>
                </div>
                <!-- Chart Section -->
                <div class="chart-section">
                    <h3>üìä Evoluci√≥n de Ingresos</h3>
                    <div class="chart-wrapper">
                        <canvas id="incomeChart"></canvas>
                    </div>
                </div>

                <!-- Annual Summary Table -->
                <div class="annual-summary mt-4">
                    <h3>Balance Mensual</h3>
                    <div class="table-container small-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mes</th>
                                    <th>Alumnos Activos</th>
                                    <th>Ingresos</th>
                                    <th>Crecimiento</th>
                                </tr>
                            </thead>
                            <tbody id="annual-stats-body">
                                <!-- Loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Members Section -->
            <section id="members" class="content-section hidden-section">
                <div class="header-row">
                    <div>
                        <h2>Gesti√≥n de Alumnos - <span id="members-month-display">Enero 2026</span></h2>
                        <div class="member-count-badge" id="member-count-badge">0 alumnos</div>
                    </div>
                    <div class="header-actions">
                        <input type="text" id="search-member-input" placeholder="üîç Buscar alumno..."
                            class="search-input">
                        <button class="btn-primary" onclick="openAddMemberModal()">+ Nuevo Alumno</button>
                    </div>
                </div>

                <!-- Filter Buttons -->
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all" onclick="filterMembers('all')">Todos</button>
                    <button class="filter-btn" data-filter="paid" onclick="filterMembers('paid')">Pagados</button>
                    <button class="filter-btn" data-filter="overdue"
                        onclick="filterMembers('overdue')">Vencidos</button>
                </div>
                <!-- Warning if limit reached -->
                <div id="limit-warning" class="warning-banner hidden">¬°L√≠mite de 300 alumnos alcanzado!</div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Contacto</th>
                                <th>Cuota (<span id="th-month-display">Mes Actual</span>)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="members-table-body">
                            <!-- Rows loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Payments Section (Historial) -->
            <section id="payments" class="content-section hidden-section">
                <div class="header-row">
                    <h2>Historial de Pagos - <span id="payments-month-display">Enero 2026</span></h2>
                    <button class="btn-primary" onclick="exportPaymentsListPDF()">üìÑ Exportar Lista</button>
                </div>

                <!-- Payment Summary Card -->
                <div class="payment-summary-card">
                    <div class="summary-item">
                        <span class="summary-label">Total del Mes:</span>
                        <span class="summary-value" id="payments-total">$0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Cantidad de Pagos:</span>
                        <span class="summary-value" id="payments-count">0</span>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Alumno</th>
                                <th>Mes Pagado</th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody id="payments-history-body">
                            <!-- Rows loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Member Modal -->
    <div id="add-member-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddMemberModal()">&times;</span>
            <h2 id="modal-title">Nuevo Alumno</h2>
            <p id="modal-limit-msg" class="text-danger hidden">No se pueden agregar m√°s alumnos.</p>
            <form id="add-member-form">
                <input type="text" id="new-name" placeholder="Nombre" required>
                <input type="text" id="new-lastname" placeholder="Apellido" required>
                <input type="text" id="new-contact" placeholder="Contacto (Tel/Email)" required>
                <button type="submit" id="save-member-btn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Record Payment Modal -->
    <div id="payment-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closePaymentModal()">&times;</span>
            <h2>Registrar Pago</h2>
            <h3 id="payment-member-name">Alumno</h3>
            <form id="payment-form">
                <input type="hidden" id="payment-member-id">
                <label>Mes a pagar</label>
                <select id="payment-month" required>
                    <!-- Options populated by JS -->
                </select>
                <input type="number" id="payment-amount" placeholder="Monto" required>
                <button type="submit">Registrar Pago</button>
            </form>
        </div>
    </div>

    <!-- Medical Notes Modal -->
    <div id="notes-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeNotesModal()">&times;</span>
            <h2>Observaciones M√©dicas</h2>
            <h3 id="notes-member-name">Alumno</h3>
            <form id="notes-form">
                <input type="hidden" id="notes-member-id">
                <textarea id="member-notes" rows="6"
                    placeholder="Escribir observaciones m√©dicas, lesiones..."></textarea>
                <button type="submit">Guardar Observaciones</button>
            </form>
        </div>
    </div>

    <!-- Custom Alert Container -->
    <div id="alert-container"></div>

    <!-- PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <script type="module" src="app.js"></script>
</body>

</html>