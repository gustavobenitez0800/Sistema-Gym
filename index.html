<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyD Funcional Gym - Gesti√≥n 2026</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/x-icon" href="./img/Logo.png">
    <link rel="stylesheet" href="style.css?v=5.0">
</head>

<body>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Abrir men√∫">
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
        <div class="hamburger-line"></div>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-card">
            <h1>AyD Funcional Gym</h1>
            <p>Acceso al Sistema</p>
            <form id="login-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Contrase√±a" required>
                <button type="submit">Ingresar</button>
            </form>
            <p id="login-error" class="error-msg"></p>
        </div>
    </div>

    <!-- Main App Layout (Hidden by default) -->
    <div id="app-layout" class="screen hidden">
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="img/Logo.png" alt="Logo" class="sidebar-logo">
                <h2>AyD Gym</h2>
            </div>
            <ul>
                <li onclick="showSection('dashboard')" class="active-nav">üìä Dashboard</li>
                <li onclick="showSection('members')">üë• Alumnos</li>
                <li onclick="showSection('payments')">üí∞ Pagos</li>
            </ul>
            <div class="month-selector-container">
                <label>Fecha de Operaci√≥n</label>
                <div class="date-quick-actions">
                    <button class="quick-btn" onclick="setToday()" title="Ir a hoy">üìÖ Hoy</button>
                    <button class="quick-btn" onclick="setCurrentMonth()" title="Ir al mes actual">üìÜ Este Mes</button>
                </div>
                <div class="date-picker-wrapper">
                    <input type="date" id="operation-date-picker" class="date-input">
                </div>
                <div class="month-navigator">
                    <button id="prev-month-btn" class="nav-btn" onclick="changeGlobalMonth(-1)"
                        title="Mes anterior">‚ùÆ</button>
                    <span id="global-month-label">Cargando...</span>
                    <button id="next-month-btn" class="nav-btn" onclick="changeGlobalMonth(1)"
                        title="Mes siguiente">‚ùØ</button>
                </div>
            </div>
            <button id="logout-btn" class="logout-btn">Cerrar Sesi√≥n</button>
        </nav>

        <main class="content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active-section">
                <!-- Header with Month Display -->
                <div class="section-header">
                    <h2>Panel General - <span id="current-month-display">Enero 2026</span></h2>
                    <button class="btn-primary" onclick="exportMonthlyReport()">üìÑ Exportar PDF</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card stat-card-members">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <h3>Alumnos Activos</h3>
                            <p id="total-members" class="stat-value">0 / 300</p>
                            <small id="growth-stat" class="stat-growth">-- vs mes anterior</small>
                        </div>
                    </div>
                    <div class="stat-card stat-card-balance">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-content">
                            <h3>Balance Mensual</h3>
                            <p id="monthly-balance" class="stat-value">$0</p>
                        </div>
                    </div>
                    <div class="stat-card stat-card-overdue">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-content">
                            <h3>Vencimientos</h3>
                            <p id="overdue-count" class="stat-value text-danger">0</p>
                        </div>
                    </div>
                    <div class="stat-card stat-card-reminder" onclick="showExpiringMembers()">
                        <div class="stat-icon">üîî</div>
                        <div class="stat-content">
                            <h3>Pr√≥ximos a Vencer</h3>
                            <p id="expiring-soon-count" class="stat-value text-warning">0</p>
                            <small class="stat-growth">Pr√≥ximos 7 d√≠as</small>
                        </div>
                    </div>
                </div>

                <!-- Widgets Row -->
                <div class="widgets-row">


                    <!-- Payment Methods Widget -->
                    <div class="widget-card">
                        <h3>üí≥ M√©todos de Pago</h3>
                        <div id="payment-methods-chart" class="widget-content">
                            <canvas id="paymentMethodsChart"></canvas>
                        </div>
                    </div>

                    <!-- Retention Widget -->
                    <div class="widget-card">
                        <h3>üìä Retenci√≥n Mensual</h3>
                        <div id="retention-stats" class="widget-content">
                            <div class="retention-item">
                                <span class="retention-label">Tasa de Retenci√≥n:</span>
                                <span id="retention-rate" class="retention-value">--</span>
                            </div>
                            <div class="retention-item">
                                <span class="retention-label">Nuevos Alumnos:</span>
                                <span id="new-members-count" class="retention-value text-success">0</span>
                            </div>
                            <div class="retention-item">
                                <span class="retention-label">Bajas:</span>
                                <span id="churned-members-count" class="retention-value text-danger">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Chart Section -->
                <div class="chart-section">
                    <h3>üìä Evoluci√≥n de Ingresos</h3>
                    <div class="chart-wrapper">
                        <canvas id="incomeChart"></canvas>
                    </div>
                </div>

                <!-- Annual Summary Table -->
                <div class="annual-summary mt-4">
                    <h3>Balance Mensual</h3>
                    <div class="table-container small-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Mes</th>
                                    <th>Alumnos Activos</th>
                                    <th>Ingresos</th>
                                    <th>Crecimiento</th>
                                </tr>
                            </thead>
                            <tbody id="annual-stats-body">
                                <!-- Loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Members Section -->
            <section id="members" class="content-section hidden-section">
                <div class="header-row">
                    <div>
                        <h2>Gesti√≥n de Alumnos - <span id="members-month-display">Enero 2026</span></h2>
                    </div>
                    <div class="header-actions">
                        <input type="text" id="search-member-input" placeholder="üîç Buscar alumno..."
                            class="search-input">
                        <button class="btn-primary" onclick="openAddMemberModal()">+ Nuevo Alumno</button>
                    </div>
                </div>

                <!-- Filter Buttons -->
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all" onclick="filterMembers('all')">Todos</button>
                    <button class="filter-btn" data-filter="paid" onclick="filterMembers('paid')">Pagados</button>
                    <button class="filter-btn" data-filter="overdue"
                        onclick="filterMembers('overdue')">Vencidos</button>

                    <div class="filter-controls">
                        <label for="sort-select">Ordenar por:</label>
                        <select id="sort-select" onchange="changeSortOrder(this.value)">
                            <option value="last_name_asc">Apellido A-Z</option>
                            <option value="last_name_desc">Apellido Z-A</option>
                            <option value="first_name_asc">Nombre A-Z</option>
                            <option value="first_name_desc">Nombre Z-A</option>
                            <option value="created_at_desc">M√°s recientes</option>
                            <option value="created_at_asc">M√°s antiguos</option>
                            <option value="status">Estado (Vencidos primero)</option>
                        </select>

                        <label for="items-per-page">Mostrar:</label>
                        <select id="items-per-page" onchange="changeItemsPerPage(this.value)">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="all">Todos</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Contacto</th>
                                <th>Cuota (<span id="th-month-display">Mes Actual</span>)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="members-table-body">
                            <!-- Rows loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Payments Section (Historial) -->
            <section id="payments" class="content-section">
                <div class="header-row">
                    <h2>Historial de Pagos - <span id="payments-month-display">Enero 2026</span></h2>
                    <div class="header-actions">
                    </div>
                </div>

                <!-- Payment Summary Card -->
                <div class="payment-summary-card">
                    <div class="summary-item">
                        <span class="summary-label">Total del Mes:</span>
                        <span class="summary-value" id="payments-total">$0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Cantidad de Pagos:</span>
                        <span class="summary-value" id="payments-count">0</span>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead id="payments-table-head">
                            <tr>
                                <th>Fecha de Pago</th>
                                <th>Alumno</th>
                                <th>Mes Pagado</th>
                                <th>M√©todo</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="payments-history-body">
                            <!-- Rows loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Member Modal -->
    <div id="add-member-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAddMemberModal()">&times;</span>
            <h2 id="modal-title">Nuevo Alumno</h2>
            <p id="modal-limit-msg" class="text-danger hidden">No se pueden agregar m√°s alumnos.</p>
            <form id="add-member-form">
                <input type="text" id="new-name" placeholder="Nombre" required>
                <input type="text" id="new-lastname" placeholder="Apellido" required>
                <input type="text" id="new-contact" placeholder="Contacto (Tel/Email)" required>

                <label>Horario de Asistencia</label>
                <input type="time" id="new-schedule-time" class="schedule-time-input">

                <label>D√≠as de Asistencia</label>
                <div class="days-selector" id="new-days-selector">
                    <label class="day-checkbox"><input type="checkbox" value="Lun"> Lun</label>
                    <label class="day-checkbox"><input type="checkbox" value="Mar"> Mar</label>
                    <label class="day-checkbox"><input type="checkbox" value="Mi√©"> Mi√©</label>
                    <label class="day-checkbox"><input type="checkbox" value="Jue"> Jue</label>
                    <label class="day-checkbox"><input type="checkbox" value="Vie"> Vie</label>
                    <label class="day-checkbox"><input type="checkbox" value="S√°b"> S√°b</label>
                </div>

                <button type="submit" id="save-member-btn">Guardar</button>
            </form>
        </div>
    </div>

    <!-- Record Payment Modal -->
    <div id="payment-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closePaymentModal()">&times;</span>
            <h2>Registrar Pago</h2>
            <h3 id="payment-member-name">Alumno</h3>
            <form id="payment-form">
                <input type="hidden" id="payment-member-id">

                <label>Mes que est√° pagando</label>
                <select id="payment-month" required>
                    <!-- Options populated by JS -->
                </select>

                <label>Fecha en que realiz√≥ el pago</label>
                <input type="date" id="payment-date-input" required style="margin-bottom: 5px;">

                <label>Fecha de vencimiento del acceso</label>
                <input type="date" id="payment-expiration-input" required style="margin-bottom: 15px;">

                <label>M√©todo de pago</label>
                <select id="payment-method-select" style="margin-bottom: 15px;">
                    <option value="Efectivo">Efectivo</option>
                    <option value="Transferencia">Transferencia</option>
                    <option value="Tarjeta">Tarjeta</option>
                    <option value="Mercado Pago">Mercado Pago</option>
                    <option value="Otro">Otro</option>
                </select>

                <label>Monto</label>
                <input type="number" id="payment-amount" placeholder="Monto" required>

                <button type="submit">Registrar Pago</button>
            </form>
        </div>
    </div>

    <!-- Edit Payment Modal -->
    <div id="edit-payment-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeEditPaymentModal()">&times;</span>
            <h2>Editar Fechas de Pago</h2>
            <div style="margin-bottom: 20px; padding: 10px; background: rgba(255,214,0,0.1); border-radius: 4px;">
                <p><strong>Alumno:</strong> <span id="edit-payment-member-name"></span></p>
                <p><strong>Mes:</strong> <span id="edit-payment-month"></span></p>
                <p><strong>Monto:</strong> <span id="edit-payment-amount"></span></p>
            </div>
            <form id="edit-payment-form">
                <input type="hidden" id="edit-payment-id">
                <label for="edit-payment-date">Fecha de Pago:</label>
                <input type="date" id="edit-payment-date" required>

                <label for="edit-expiration-date">Fecha de Vencimiento:</label>
                <input type="date" id="edit-expiration-date" required>

                <button type="submit">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <!-- Edit Member Modal -->
    <div id="edit-member-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeEditMemberModal()">&times;</span>
            <h2>Editar Alumno</h2>
            <form id="edit-member-form">
                <input type="hidden" id="edit-member-id">
                <label>Nombre</label>
                <input type="text" id="edit-name" placeholder="Nombre" required>
                <label>Apellido</label>
                <input type="text" id="edit-lastname" placeholder="Apellido" required>
                <label>Contacto</label>
                <input type="text" id="edit-contact" placeholder="Contacto (Tel/Email)" required>

                <label>Horario de Asistencia</label>
                <input type="time" id="edit-schedule-time" class="schedule-time-input">

                <label>D√≠as de Asistencia</label>
                <div class="days-selector" id="edit-days-selector">
                    <label class="day-checkbox"><input type="checkbox" value="Lun"> Lun</label>
                    <label class="day-checkbox"><input type="checkbox" value="Mar"> Mar</label>
                    <label class="day-checkbox"><input type="checkbox" value="Mi√©"> Mi√©</label>
                    <label class="day-checkbox"><input type="checkbox" value="Jue"> Jue</label>
                    <label class="day-checkbox"><input type="checkbox" value="Vie"> Vie</label>
                    <label class="day-checkbox"><input type="checkbox" value="S√°b"> S√°b</label>
                </div>

                <button type="submit" id="update-member-btn">Actualizar</button>
            </form>
        </div>
    </div>

    <!-- Medical Notes Modal -->
    <div id="notes-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" onclick="closeNotesModal()">&times;</span>
            <h2>Observaciones M√©dicas</h2>
            <h3 id="notes-member-name">Alumno</h3>
            <form id="notes-form">
                <input type="hidden" id="notes-member-id">
                <textarea id="member-notes" rows="6"
                    placeholder="Escribir observaciones m√©dicas, lesiones..."></textarea>
                <button type="submit">Guardar Observaciones</button>
            </form>
        </div>
    </div>

    <!-- Expiring Members Modal -->
    <div id="expiring-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-btn" onclick="closeExpiringModal()">&times;</span>
            <h2>üîî Alumnos Pr√≥ximos a Vencer</h2>
            <p style="color: #999; margin-bottom: 20px;">Vencen en los pr√≥ximos 7 d√≠as</p>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Alumno</th>
                            <th>Contacto</th>
                            <th>Vence</th>
                            <th>D√≠as</th>
                        </tr>
                    </thead>
                    <tbody id="expiring-members-body">
                        <!-- Loaded via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Custom Alert Container -->
    <div id="alert-container"></div>

    <!-- PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <script type="module" src="app.js"></script>
</body>

</html>